<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ProyBackEnd</title>
    <!-- <link href="//cdn.muicss.com/mui-0.10.3/css/mui.min.css" rel="stylesheet" type="text/css" />
    <script src="//cdn.muicss.com/mui-0.10.3/js/mui.min.js"></script> -->
    <link href="./css/mui.min.css" rel="stylesheet" type="text/css" />
    <link href="./css/estilos.css" rel="stylesheet" type="text/css" />
  </head>
  <body class="contenedor" style="background-color: rgb(247, 251, 255)">
    <div class="mui-container-fluid">
      <div
        class="mui--text-display1 mui--text-center"
        style="height: 50px; margin-top: 20px"
      >
        Coder House eCommerce BackEnd
      </div>
      <div class="mui-divider"></div>

      <!--  -->
      <div
        class="mui-row"
        style="margin-top: 10px; background-color: rgb(241, 238, 238)"
      >
        <!--Usuario Logeado  -->
        <script type="text/x-handlebars-template" id="handlebUsuarioLogeado">
          <div
            class="mui-col-md-4 mui--text-center"
            style="background-color: rgb(208, 222, 235)"
          >
            <h2>Hola: {{usuario}} </h2>
          </div>

          <div
            class="mui-col-md-2 mui--text-center"
            style="background-color: rgb(241, 238, 238);margin-top:10px"
          >

            <button
              id="perfilUsuario"
              class="mui-btn mui-btn--small mui-btn--raised mui-btn--primary"
              onclick="activateModal2()"
            > PerfilUsuario </button>

          </div>
          <div
            class="mui-col-md-1 mui--text-center"
            style="background-color: rgb(241, 238, 238);margin-top:10px"
          >
            <img
              id="avatarUsuario"
              src={{avatar}}
              alt="avatarClie"
              width="50"
              height="60"
            />
          </div>
        </script>

        <div id="rendUsuarioLogeado"></div>

        <!--Usuario Logeado  -->

        <div
          class="mui-col-md-2 mui--text-center"
          style="background-color: rgb(241, 238, 238); margin-top: 10px"
        >
          <button
            id="chatear"
            class="mui-btn mui-btn--small mui-btn--raised mui-btn--danger"
          >
            Chatear
          </button>
        </div>

        <div
          class="mui-col-md-2 mui--text-center"
          style="background-color: rgb(241, 238, 238); margin-top: 10px"
        >
          <button
            id="desLogearse"
            class="mui-btn mui-btn--small mui-btn--raised mui-btn--accent"
          >
            Deslogear
          </button>
        </div>
      </div>
      <!--  -->

      <div class="mui-row" style="margin-left: 10px; margin-top: 20px">

        <!-- Formulario -->
        <div class="mui-col-md-4" style="background-color: white">

         
          <h1>Editar Producto</h1>

          <script type="text/x-handlebars-template" id="handlebFormEditarProducto">
          
          {{#each prod}}
          <form class="mui-form">
            <div class="mui-textfield">
             
              <input id="nombre" type="text" value="{{nombre}}" placeholder="Nombre" />
  
            </div>

            <div class="mui-textfield">
              <input id="descripcion" type="text" value="{{descripcion}}" placeholder="Descripción" />
            </div>
            <div class="mui-textfield">
              <input id="codigo" type="text" value="{{codigo}}" placeholder="Código" />
            </div>
            <div class="mui-textfield">
              <input id="urlFoto" type="text" value="{{urlFoto}}" placeholder="urlFoto" />
            </div>
            <div class="mui-textfield">
              <input id="precio" type="text"  value="{{precio}}" placeholder="Precio" />
            </div>
            <div class="mui-textfield">
              <input id="stock" type="text"  value="{{stock}}" placeholder="Stock" />
            </div>
            <div class="mui-textfield">
              <input id="categoria" type="text"  value="{{categoria}}" placeholder="Categoria" />
            </div>

            
          </form>
          {{/each}}
        </script>
            <!--Renderizado Plantilla Handlebars Editar-->

            <div id="rendFormProd"></div>

           <!--Renderizado Plantilla Handlebars Editar-->

           <div class="mui--text-center">
            <button
              id="editarProd"
              class="mui-btn mui-btn--raised mui-btn--primary"
            >
              Editar Producto
            </button>
          </div>
           
        </div>
      
         

        <!-- Formulario -->

        <div class="mui-col-md-8" style="background-color: rgb(246, 235, 235)">
          <!-- <div class="mui--text-center">
                <button id="cargarTabla" class=" mui-btn mui-btn--raised mui-btn--primary"> Cargar Tabla</button>
               </div> -->

          <script type="text/x-handlebars-template" id="handlebTablaProductos">
            <!--Row Formulario Listado -->

            <!-- Listado de Productos Armado plantilla Handlebars-->

            <h2 class="mui--text-center">Producto a editar:{{prod.length}}</h2>
            <table class="mui-table mui-table--bordered mui-striped">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Descripción</th>
                  <th>Código</th>
                  <th>Imagen</th>
                  <th>Precio</th>
                  <th>Stock</th>
                  <th>Categoria</th>
                </tr>
              </thead>

              <tbody>
                {{#if prodHayUa}}
                  {{#each prod}}
                    <tr>
                      <td>{{nombre}} </td>
                      <td>{{descripcion}} </td>
                      <td>{{codigo}} </td>
                      <td class="mui--text-center"><img
                          src={{urlFoto}}
                          width="50"
                          height="50"
                          alt="coder"
                        />
                      </td>
                      <td>{{precio}} </td>
                      <td>{{stock}} </td>
                      <td>{{categoria}} </td>
                      <!-- <td><button
                          id="editarProd"
                          class="mui-btn mui-btn--small mui-btn--raised mui-btn--accent"
                          data="{{_id}}"
                        > Editar</button>
                      </td> -->
                      <!-- <td><button
                          id="borrarProd"
                          class="mui-btn mui-btn--small mui-btn--raised mui-btn--danger"
                          data="{{_id}}"
                        > Borrar</button>
                      </td> -->
                      <!--  <td><button id="enviarProd" class=" mui-btn mui-btn--small mui-btn--raised mui-btn--primary"> Comprar</button> </td> -->
                    </tr>
                  {{/each}}
                {{else}}
                {{/if}}

                {{#if prodHayUu}}
                  {{#each prod}}
                    <tr>
                      <td>{{nombre}} </td>
                      <td>{{descripcion}} </td>
                      <td>{{codigo}} </td>
                      <td class="mui--text-center"><img
                          src={{urlFoto}}
                          width="30"
                          height="30"
                          alt="coder"
                        />
                      </td>
                      <td>{{precio}} </td>
                      <td>{{stock}} </td>
                      <td><button
                          id="enviarProd"
                          class="mui-btn mui-btn--small mui-btn--raised mui-btn--primary"
                        > Comprar</button>
                      </td>
                    </tr>
                  {{/each}}
                {{else}}
                {{/if}}

              </tbody>

            </table>

            {{#if prodHay}}{{else}}
              <h3
                class="mui--text-center"
                style="background-color:rgb(230, 138, 138)"
              > Disculpe, no hay productos</h3>
            {{/if}}

            <!-- Listado de Productos Armado plantilla Handlebars-->

          </script>
          <!--Row Formulario Listado -->

          <!--Renderizado Plantilla Handlebars Productos-->

          <div id="rendProd"></div>

          <!--Renderizado Plantilla Handlebars Productos-->
        </div>
      </div>

      <!--  <div class="mui-col-md-2"></div> -->

      <div class="mui-divider"></div>

      <div class="mui-row">
        <div class="mui-col-md-4"></div>

        <div class="mui-col-md-4"></div>

        <div class="mui-col-md-4"></div>
      </div>

      <br />

      <div class="mui-divider"></div>

      <!-- Area del Websocket -->

      <!-- <div class="mui-row" style="margin-top:10px;background-color: rgb(241, 238, 238)">
         <div class="mui--text-display1  mui--text-center" style="height:50px; color:blue">Listado Carrito</div>

          <div class="mui-col-md-2" style="background-color: rgb(241, 238, 238)">
            <h3></h3>
          
           
          </div>
          <div class="mui-col-md-8 mui--text-center " style="background-color: rgb(208, 222, 235)">
            <h3></h3> -->

      <!--Grilla Carrito  -->

      <!--Grilla Carrito  -->

      <!-- </div>
          <div class="mui-col-md-2"  style="background-color: rgb(241, 238, 238)">
           <h3></h3>

         
          </div>

        </div> -->

      <!--  -->
    </div>
    <!-- container fluid -->

    <dialog id="modal1" style="background-color: rgb(188, 191, 198)">
      <!--Ventana Modal Usuario Logeado  -->

      <script type="text/x-handlebars-template" id="handlebUsuarioLogeado1">
        <div class="mui-container">
          <div class="mui-panel">

            <h3>Datos del usuario:</h3>
            <h4>Nombre: {{usuario}} </h4>
            <h4>Edad: {{edad}} </h4>
            <h4>Tipo de Perfil: {{tipo}} </h4>
            <h4>Correo: {{correo}} </h4>

          </div>
        </div>
      </script>

      <div id="rendUsuarioLogeado1"></div>
      <!--Ventana Modal Usuario Logeado  -->
      <button
        class="mui-btn mui-btn--small mui-btn--primary mui-btn--raised"
        onclick="window.modal1.close()"
      >
        Cerrar
      </button>
    </dialog>

    <script src="./js/mui.min.js"></script>

    <script src="./socket.io/socket.io.min.js"></script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.7/handlebars.min.js"
      integrity="sha512-RNLkV3d+aLtfcpEyFG8jRbnWHxUqVZozacROI4J2F1sTaDqo1dPQYs01OMi1t1w9Y2FdbSCDSQ2ZVdAC8bzgAg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script src="./js/productosEditar00.js"></script>

    <!-- <script src="./js/productos01.js"></script> -->

    <script>

      //let idProducto=localStorage.getItem("idProducto");

      const botonEditarProd = document.querySelector("#editarProd");
      const botonDeslogear = document.querySelector("#desLogearse");
      const botonChatear = document.querySelector("#chatear");

      //Deslogea al usuario
      //
      botonDeslogear.addEventListener("click", (e) => {
        e.preventDefault();

        console.log("Apretando el Boton deslogear");
        console.log(URL + "logout.html");

        //cargar una pagina HTML
        //
        location.assign(URL + "logout.html");
      });

      //Chatear
      //
      botonChatear.addEventListener("click", (e) => {
        e.preventDefault();

        console.log("Apretando el Boton Chatear");

        //cargar una pagina HTML
        //
        location.assign(URL + "chatAdm.html");
      });



      
      //Editar Producto  del lado del cliente
      //
      botonEditarProd.addEventListener("click", (e) => {
        e.preventDefault();

        console.log("Apretando el Boton editar producto");

        const inputNombre = document.querySelector("#nombre").value;
        const inputDescripcion = document.querySelector("#descripcion").value;
        const inputCodigo = document.querySelector("#codigo").value;
        const inputurlFoto = document.querySelector("#urlFoto").value;
        const inputPrecio = document.querySelector("#precio").value;
        const inputStock = document.querySelector("#stock").value;
        const inputCategoria = document.querySelector("#categoria").value;

        const producto = {
          nombre: inputNombre,
          descripcion: inputDescripcion,
          codigo: Number(inputCodigo),
          urlFoto: inputurlFoto,
          precio: Number(inputPrecio),
          stock: Number(inputStock),
          categoria: inputCategoria,
        };

        console.log("Cliente enviando Producto");
        console.log(producto);

        //socket.emit("nuevoProducto", producto);

        //Petición Post HTTP envia producto a la ruta
        //en formato JSON

        fetch(URL + `api/productos/${idProducto}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(producto),
        })
          .then((respuesta) => {
            console.log("Todo bien:", respuesta);
            return respuesta.json();
          })
          .then((data) => {
            console.log("Todo bien:", data.mensaje);

            location.assign(URL+"productosAdm.html");

          })
          .catch((error) => {
            console.error("Error:", error);
          });
      });



      function activateModal2() {
        window.modal1.showModal();
      }


      //Captura el click de los botones (editar-borrar)
      //de la tabla.
      //-----------------------------------------------
      let idForm = 0;
      let idReg = 0;
      let titulo = "";
      document.addEventListener("click", (e) => {
        if (e.target.matches("#editarProd")) {
          //Boton Editar
          idReg = e.path[0].attributes.data.value;
          console.log("Apretando el boton editar");
          console.log(` id= ${idReg} ?`);
          console.log(idReg);

          //titulo = `¿Está seguro de Editar el  id= ${idReg} ?`;
          titulo = `¿Está seguro de Editar el registro seleccionado... ?`;
          if (confirm(titulo) == true) {

            text = "You pressed OK!";
            location.assign(URL+"productosAdm.html");

          } else {

            text = "You canceled!";

          }
        }

        if (e.target.matches("#borrarProd")) {
          //Boton Borrar
          idForm = e.target.dataset.id1;
          idReg = e.path[0].attributes.data.value;
          console.log("Apretando el boton borrar");
          console.log(` id= ${idReg} ?`);
          console.log(idReg);

          //titulo = `¿Está seguro de Borrar el  id= ${idReg} ?`;
          titulo = `¿Está seguro de Borrar el registro seleccionado... ?`;
        
          if (confirm(titulo) == true) {

            text = "You pressed OK!";



            location.assign(URL+"productosAdm.html");

          } else {

            text = "You canceled!";

          }
        }

  
      });

    </script>
  </body>
</html>
